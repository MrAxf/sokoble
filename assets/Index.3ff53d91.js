import{r as i,j as r,a as F,M as N,b as k,c as P,d as q,e as M,m as v}from"./index.cf840777.js";const w={board:{board:[],boxes:[],player:{x:0,y:0}},player:{x:0,y:0},boxes:{},meta:{size:0,walls:{top:0,bottom:0,left:0,right:0},squarePercent:0},undoStack:[],setPlayer:()=>{},setBoxes:()=>{},setMeta:()=>{},setUndoStack:()=>{}},S=i.exports.createContext({...w}),T=({children:t,board:e})=>{const[n,o]=i.exports.useState(!1),[l,a]=i.exports.useState(w.player),[s,d]=i.exports.useState(w.boxes),[O,B]=i.exports.useState(w.meta),[x,p]=i.exports.useState([]);return i.exports.useEffect(()=>{var E;const c=Math.max(e.board.length,(E=e.board[0])==null?void 0:E.length),u=(c-e.board.length)/2,b=(c-e.board[0].length)/2,g={top:1+Math.floor(u),bottom:1+Math.ceil(u),left:1+Math.floor(b),right:1+Math.ceil(b)};return a({...e.player}),d(e.boxes.reduce((h,f,R)=>{var y;return{...h,[R]:{...f,inButton:((y=e.board[f.y])==null?void 0:y[f.x])==="BUTTON"}}},{})),B({size:c,squarePercent:100/(c+2),walls:g}),o(!0),()=>{o(!1)}},[e]),r(S.Provider,{value:{board:e,player:l,boxes:s,meta:O,undoStack:x,setPlayer:a,setBoxes:d,setMeta:B,setUndoStack:p},children:n&&t})},A=()=>{const{board:t,boxes:e,meta:n,player:o,undoStack:l,setPlayer:a,setBoxes:s,setUndoStack:d}=i.exports.useContext(S);return{board:t,boxes:e,meta:n,player:o,movePlayer:x=>{var y,K;const p={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}}[x],c={x:o.x+p.x,y:o.y+p.y},u={x:c.x+p.x,y:c.y+p.y},b=(y=t.board[c.y])==null?void 0:y[c.x],g=(K=t.board[u.y])==null?void 0:K[u.x];let E,h;Object.entries(e).forEach(([L,C])=>{if(C.x===c.x&&C.y===c.y){E=parseInt(L);return}C.x===u.x&&C.y===u.y&&(h=parseInt(L))});const f=Boolean(b)&&b!=="BLOCK",R=Boolean(g)&&g!=="BLOCK";if(E===void 0&&f){d([...l,{player:{...o},boxes:{...e}}]),a(c);return}E!==void 0&&h===void 0&&f&&R&&(d([...l,{player:{...o},boxes:{...e}}]),a(c),s({...e,[E]:{...u,inButton:g==="BUTTON"}}))},undo:()=>{const x=l.at(-1);x&&(d(l.slice(0,-1)),a(x.player),s(x.boxes))}}},m=A;function U({children:t}){const e=i.exports.useRef(null),{movePlayer:n,undo:o}=m(),l=a=>{if(a.preventDefault(),a.ctrlKey&&a.key==="z")o();else{const s={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"}[a.key];s&&n(s)}};return i.exports.useEffect(()=>{e.current&&e.current.focus()},[e]),r("div",{tabIndex:0,className:"h-full p-5 flex flex-col",ref:e,onKeyDown:l,children:t})}function $(){const{movePlayer:t,undo:e}=m(),n=o=>l=>{l.preventDefault(),l.button===0&&t(o)};return F("div",{className:"flex-grow grid max-h-[250px] grid-cols-3 grid-rows-2 gap-2 p-2 pb-14",children:[r("button",{className:"grid rounded-md text-xl place-content-center row-start-1 col-start-1 bg-green-500 hover:bg-green-700 transition text-white",onClick:e,children:r(N,{})}),r("button",{className:"grid rounded-md text-xl place-content-center row-start-1 col-start-2 bg-green-500 hover:bg-green-700 transition text-white",onClick:n("up"),children:r(k,{})}),r("button",{className:"grid rounded-md text-xl place-content-center row-start-2 col-start-1 bg-green-500 hover:bg-green-700 transition text-white",onClick:n("left"),children:r(P,{})}),r("button",{className:"grid rounded-md text-xl place-content-center row-start-2 col-start-2 bg-green-500 hover:bg-green-700 transition text-white",onClick:n("down"),children:r(q,{})}),r("button",{className:"grid rounded-md text-xl place-content-center row-start-2 col-start-3 bg-green-500 hover:bg-green-700 transition text-white",onClick:n("right"),children:r(M,{})})]})}function z({x:t,y:e,inButton:n}){const{meta:o}=m();return r(v.div,{className:`absolute aspect-square rounded-md transition ${n?"bg-blue-700":"bg-orange-700"}`,style:{width:`${o.squarePercent}%`},animate:{left:`${(o.walls.left+t)*o.squarePercent}%`,top:`${(o.walls.top+e)*o.squarePercent}%`},children:r("div",{className:`w-1/2 transition ${n?"bg-blue-500":"bg-orange-500"} aspect-square m-[25%]`})})}function D(){const{meta:t,player:e}=m();return r(v.div,{className:"absolute aspect-square rounded-full bg-yellow-600",style:{width:`${t.squarePercent}%`},animate:{left:`${(t.walls.left+e.x)*t.squarePercent}%`,top:`${(t.walls.top+e.y)*t.squarePercent}%`}})}function j(){const{meta:t,board:e,boxes:n}=m(),o=(a,s)=>({BLOCK:r("div",{className:"bg-purple-900 aspect-square"},s),FREE:r("div",{className:"bg-purple-300 aspect-square"},s),BUTTON:r("div",{className:"bg-purple-300 aspect-square after:content-[''] after:bg-purple-50 after:rounded-full after:m-[25%] after:block after:w-1/2 after:h-1/2"},s)})[a],l=i.exports.useCallback(()=>{if(!t.size)return null;let a=0;return[...Array(t.walls.top*(t.size+2)).fill("").map(()=>o("BLOCK",String(a++))),...e.board.map(s=>[...Array(t.walls.left).fill("").map(()=>o("BLOCK",String(a++))),...s.map(d=>o(d,String(a++))),...Array(t.walls.right).fill("").map(()=>o("BLOCK",String(a++)))]).flat(),...Array(t.walls.bottom*(t.size+2)).fill("").map(()=>o("BLOCK",String(a++)))]},[t]);return F("div",{role:"grid",className:"grid w-full flex-grow-0 aspect-square rounded-xl border-4 border-violet-600 max-w-full max-h-full relative overflow-hidden",style:{gridTemplateColumns:`repeat(${(t.size||0)+2}, 1fr)`},children:[l(),r(D,{}),Object.entries(n).map(([a,s])=>r(z,{...s},a))]})}function I(){return r(T,{board:{board:[["BLOCK","FREE","FREE","BLOCK","BLOCK","BLOCK","FREE","FREE"],["FREE","FREE","FREE","FREE","FREE","FREE","FREE","FREE"],["FREE","FREE","FREE","FREE","FREE","BLOCK","FREE","FREE"],["BLOCK","FREE","FREE","BLOCK","BLOCK","BLOCK","FREE","FREE"],["BLOCK","FREE","FREE","BLOCK","BUTTON","BUTTON","FREE","FREE"],["BLOCK","FREE","BLOCK","BLOCK","BUTTON","BLOCK","FREE","BLOCK"],["FREE","FREE","FREE","FREE","FREE","FREE","BLOCK","BLOCK"],["FREE","FREE","FREE","FREE","FREE","BLOCK","BLOCK","BLOCK"]],player:{x:2,y:2},boxes:[{x:3,y:2},{x:2,y:3},{x:1,y:1}]},children:F(U,{children:[r(j,{}),r("div",{className:"flex-grow"}),r($,{})]})})}function W(){return r(I,{})}export{W as default};
