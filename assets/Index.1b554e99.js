import{r as i,j as o,a as h,M as N,b as k,c as P,d as q,e as M,m as v}from"./index.f70c7e12.js";const O={board:{board:[],boxes:[],player:{x:0,y:0}},player:{x:0,y:0},boxes:{},meta:{size:0,walls:{top:0,bottom:0,left:0,right:0},squarePercent:0},undoStack:[],setPlayer:()=>{},setBoxes:()=>{},setMeta:()=>{},setUndoStack:()=>{}},S=i.exports.createContext({...O}),T=({children:t,board:e})=>{const[a,r]=i.exports.useState(!1),[l,n]=i.exports.useState(O.player),[s,d]=i.exports.useState(O.boxes),[F,K]=i.exports.useState(O.meta),[E,p]=i.exports.useState([]);return i.exports.useEffect(()=>{var x;const c=Math.max(e.board.length,(x=e.board[0])==null?void 0:x.length),u=(c-e.board.length)/2,b=(c-e.board[0].length)/2,C={top:1+Math.floor(u),bottom:1+Math.ceil(u),left:1+Math.floor(b),right:1+Math.ceil(b)};return n({...e.player}),d(e.boxes.reduce((y,f,R)=>{var B;return{...y,[R]:{...f,inButton:((B=e.board[f.y])==null?void 0:B[f.x])==="BUTTON"}}},{})),K({size:c,squarePercent:100/(c+2),walls:C}),r(!0),()=>{r(!1)}},[e]),o(S.Provider,{value:{board:e,player:l,boxes:s,meta:F,undoStack:E,setPlayer:n,setBoxes:d,setMeta:K,setUndoStack:p},children:a&&t})},A=()=>{const{board:t,boxes:e,meta:a,player:r,undoStack:l,setPlayer:n,setBoxes:s,setUndoStack:d}=i.exports.useContext(S);return{board:t,boxes:e,meta:a,player:r,movePlayer:E=>{var B,L;const p={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}}[E],c={x:r.x+p.x,y:r.y+p.y},u={x:c.x+p.x,y:c.y+p.y},b=(B=t.board[c.y])==null?void 0:B[c.x],C=(L=t.board[u.y])==null?void 0:L[u.x];let x,y;Object.entries(e).forEach(([w,m])=>{if(m.x===c.x&&m.y===c.y){x=parseInt(w);return}m.x===u.x&&m.y===u.y&&(y=parseInt(w))});const f=Boolean(b)&&b!=="BLOCK",R=Boolean(C)&&C!=="BLOCK";if(x===void 0&&f){d([...l,{player:{...r},boxes:{...e}}]),n(c);return}x!==void 0&&y===void 0&&f&&R&&(d([...l,{player:{...r},boxes:{...e}}]),n(c),s({...e,[x]:{...u,inButton:C==="BUTTON"}}))},undo:()=>{const E=l.at(-1);E&&(d(l.slice(0,-1)),n(E.player),s(E.boxes))}}},g=A;function U({children:t}){const e=i.exports.useRef(null),{movePlayer:a,undo:r}=g(),l=n=>{if(n.preventDefault(),n.ctrlKey&&n.key==="z")r();else{const s={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"}[n.key];s&&a(s)}};return i.exports.useEffect(()=>{e.current&&e.current.focus()},[e]),o("div",{tabIndex:0,className:"h-full p-5 flex flex-col",ref:e,onKeyDown:l,children:t})}function $(){const{movePlayer:t,undo:e}=g(),a=r=>l=>{l.preventDefault(),l.button===0&&t(r)};return h("div",{className:"flex-grow grid grid-cols-3 grid-rows-3 gap-2 p-2",children:[o("button",{className:"grid rounded-md text-xl place-content-center row-start-1 col-start-1 bg-green-500 hover:bg-green-700 transition text-white",onClick:e,children:o(N,{})}),o("button",{className:"grid rounded-md text-xl place-content-center row-start-1 col-start-2 bg-green-500 hover:bg-green-700 transition text-white",onClick:a("up"),children:o(k,{})}),o("button",{className:"grid rounded-md text-xl place-content-center row-start-2 col-start-1 bg-green-500 hover:bg-green-700 transition text-white",onClick:a("left"),children:o(P,{})}),o("button",{className:"grid rounded-md text-xl place-content-center row-start-2 col-start-3 bg-green-500 hover:bg-green-700 transition text-white",onClick:a("right"),children:o(q,{})}),o("button",{className:"grid rounded-md text-xl place-content-center row-start-3 col-start-2 bg-green-500 hover:bg-green-700 transition text-white",onClick:a("down"),children:o(M,{})})]})}function z({x:t,y:e,inButton:a}){const{meta:r}=g();return o(v.div,{className:`absolute aspect-square rounded-md transition ${a?"bg-blue-700":"bg-orange-700"}`,style:{width:`${r.squarePercent}%`},animate:{left:`${(r.walls.left+t)*r.squarePercent}%`,top:`${(r.walls.top+e)*r.squarePercent}%`},children:o("div",{className:`w-1/2 transition ${a?"bg-blue-500":"bg-orange-500"} aspect-square m-[25%]`})})}function D(){const{meta:t,player:e}=g();return o(v.div,{className:"absolute aspect-square rounded-full bg-yellow-600",style:{width:`${t.squarePercent}%`},animate:{left:`${(t.walls.left+e.x)*t.squarePercent}%`,top:`${(t.walls.top+e.y)*t.squarePercent}%`}})}function j(){const{meta:t,board:e,boxes:a}=g(),r=(n,s)=>({BLOCK:o("div",{className:"bg-purple-900 aspect-square"},s),FREE:o("div",{className:"bg-purple-300 aspect-square"},s),BUTTON:o("div",{className:"bg-purple-300 aspect-square after:content-[''] after:bg-purple-50 after:rounded-full after:m-[25%] after:block after:w-1/2 after:h-1/2"},s)})[n],l=i.exports.useCallback(()=>{if(!t.size)return null;let n=0;return[...Array(t.walls.top*(t.size+2)).fill("").map(()=>r("BLOCK",String(n++))),...e.board.map(s=>[...Array(t.walls.left).fill("").map(()=>r("BLOCK",String(n++))),...s.map(d=>r(d,String(n++))),...Array(t.walls.right).fill("").map(()=>r("BLOCK",String(n++)))]).flat(),...Array(t.walls.bottom*(t.size+2)).fill("").map(()=>r("BLOCK",String(n++)))]},[t]);return h("div",{role:"grid",className:"grid w-full flex-grow-0 aspect-square rounded-xl border-4 border-violet-600 max-w-full max-h-full relative overflow-hidden",style:{gridTemplateColumns:`repeat(${(t.size||0)+2}, 1fr)`},children:[l(),o(D,{}),Object.entries(a).map(([n,s])=>o(z,{...s},n))]})}function I(){return o(T,{board:{board:[["BLOCK","BLOCK","BLOCK","FREE","BLOCK","BLOCK","BLOCK","BLOCK","BLOCK","BLOCK"],["BLOCK","BLOCK","FREE","FREE","BLOCK","BLOCK","BLOCK","FREE","FREE","FREE"],["BLOCK","FREE","FREE","FREE","FREE","FREE","FREE","FREE","FREE","FREE"],["FREE","FREE","FREE","FREE","FREE","FREE","BLOCK","FREE","FREE","FREE"],["BLOCK","BLOCK","FREE","FREE","BLOCK","BLOCK","BLOCK","FREE","FREE","FREE"],["BLOCK","BLOCK","FREE","FREE","BLOCK","BUTTON","BUTTON","FREE","FREE","FREE"],["BLOCK","BLOCK","FREE","BLOCK","BLOCK","BUTTON","BLOCK","FREE","BLOCK","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","FREE","FREE","BLOCK","BLOCK","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","FREE","BLOCK","BLOCK","BLOCK","BLOCK"]],player:{x:3,y:3},boxes:[{x:4,y:3},{x:3,y:4},{x:2,y:2}]},children:h(U,{children:[o(j,{}),o($,{})]})})}function W(){return o(I,{})}export{W as default};
