import{r as i,j as o,a as R,M as N,b as k,c as P,d as q,e as M,m as v}from"./index.4adac358.js";const h={board:{board:[],boxes:[],player:{x:0,y:0}},player:{x:0,y:0},boxes:{},meta:{size:0,walls:{top:0,bottom:0,left:0,right:0},squarePercent:0},undoStack:[],setPlayer:()=>{},setBoxes:()=>{},setMeta:()=>{},setUndoStack:()=>{}},S=i.exports.createContext({...h}),T=({children:t,board:e})=>{const[a,r]=i.exports.useState(!1),[l,n]=i.exports.useState(h.player),[s,d]=i.exports.useState(h.boxes),[w,O]=i.exports.useState(h.meta),[x,p]=i.exports.useState([]);return i.exports.useEffect(()=>{var E;const c=Math.max(e.board.length,(E=e.board[0])==null?void 0:E.length),u=(c-e.board.length)/2,b=(c-e.board[0].length)/2,C={top:1+Math.floor(u),bottom:1+Math.ceil(u),left:1+Math.floor(b),right:1+Math.ceil(b)};return n({...e.player}),d(e.boxes.reduce((B,f,K)=>{var g;return{...B,[K]:{...f,inButton:((g=e.board[f.y])==null?void 0:g[f.x])==="BUTTON"}}},{})),O({size:c,squarePercent:100/(c+2),walls:C}),r(!0),()=>{r(!1)}},[e]),o(S.Provider,{value:{board:e,player:l,boxes:s,meta:w,undoStack:x,setPlayer:n,setBoxes:d,setMeta:O,setUndoStack:p},children:a&&t})},A=()=>{const{board:t,boxes:e,meta:a,player:r,undoStack:l,setPlayer:n,setBoxes:s,setUndoStack:d}=i.exports.useContext(S);return{board:t,boxes:e,meta:a,player:r,movePlayer:x=>{var g,F;const p={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}}[x],c={x:r.x+p.x,y:r.y+p.y},u={x:c.x+p.x,y:c.y+p.y},b=(g=t.board[c.y])==null?void 0:g[c.x],C=(F=t.board[u.y])==null?void 0:F[u.x];let E,B;Object.entries(e).forEach(([L,m])=>{if(m.x===c.x&&m.y===c.y){E=parseInt(L);return}m.x===u.x&&m.y===u.y&&(B=parseInt(L))});const f=Boolean(b)&&b!=="BLOCK",K=Boolean(C)&&C!=="BLOCK";if(E===void 0&&f){d([...l,{player:{...r},boxes:{...e}}]),n(c);return}E!==void 0&&B===void 0&&f&&K&&(d([...l,{player:{...r},boxes:{...e}}]),n(c),s({...e,[E]:{...u,inButton:C==="BUTTON"}}))},undo:()=>{const x=l.at(-1);x&&(d(l.slice(0,-1)),n(x.player),s(x.boxes))}}},y=A;function U({children:t}){const e=i.exports.useRef(null),{movePlayer:a,undo:r}=y(),l=n=>{if(n.preventDefault(),n.ctrlKey&&n.key==="z")r();else{const s={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"}[n.key];s&&a(s)}};return i.exports.useEffect(()=>{e.current&&e.current.focus()},[e]),o("div",{tabIndex:0,className:"h-full p-5 flex flex-col",ref:e,onKeyDown:l,children:t})}function $(){const{movePlayer:t,undo:e}=y(),a=r=>l=>{l.preventDefault(),l.button===0&&t(r)};return R("div",{className:"flex-grow grid grid-cols-3 grid-rows-3 gap-2 p-2",children:[o("button",{className:"grid rounded-md text-xl place-content-center row-start-1 col-start-1 bg-green-500 hover:bg-green-700 transition text-white",onClick:e,children:o(N,{})}),o("button",{className:"grid rounded-md text-xl place-content-center row-start-1 col-start-2 bg-green-500 hover:bg-green-700 transition text-white",onClick:a("up"),children:o(k,{})}),o("button",{className:"grid rounded-md text-xl place-content-center row-start-2 col-start-1 bg-green-500 hover:bg-green-700 transition text-white",onClick:a("left"),children:o(P,{})}),o("button",{className:"grid rounded-md text-xl place-content-center row-start-2 col-start-3 bg-green-500 hover:bg-green-700 transition text-white",onClick:a("right"),children:o(q,{})}),o("button",{className:"grid rounded-md text-xl place-content-center row-start-3 col-start-2 bg-green-500 hover:bg-green-700 transition text-white",onClick:a("down"),children:o(M,{})})]})}function z({x:t,y:e,inButton:a}){const{meta:r}=y();return o(v.div,{className:`absolute aspect-square rounded-md transition ${a?"bg-blue-700":"bg-orange-700"}`,style:{width:`${r.squarePercent}%`},animate:{left:`${(r.walls.left+t)*r.squarePercent}%`,top:`${(r.walls.top+e)*r.squarePercent}%`},children:o("div",{className:`w-1/2 transition ${a?"bg-blue-500":"bg-orange-500"} aspect-square m-[25%]`})})}function D(){const{meta:t,player:e}=y();return o(v.div,{className:"absolute aspect-square rounded-full bg-yellow-600",style:{width:`${t.squarePercent}%`},animate:{left:`${(t.walls.left+e.x)*t.squarePercent}%`,top:`${(t.walls.top+e.y)*t.squarePercent}%`}})}function j(){const{meta:t,board:e,boxes:a}=y(),r=(n,s)=>({BLOCK:o("div",{className:"bg-purple-900 aspect-square"},s),FREE:o("div",{className:"bg-purple-300 aspect-square"},s),BUTTON:o("div",{className:"bg-purple-300 aspect-square after:content-[''] after:bg-purple-50 after:rounded-full after:m-[25%] after:block after:w-1/2 after:h-1/2"},s)})[n],l=i.exports.useCallback(()=>{if(!t.size)return null;let n=0;return[...Array(t.walls.top*(t.size+2)).fill("").map(()=>r("BLOCK",String(n++))),...e.board.map(s=>[...Array(t.walls.left).fill("").map(()=>r("BLOCK",String(n++))),...s.map(d=>r(d,String(n++))),...Array(t.walls.right).fill("").map(()=>r("BLOCK",String(n++)))]).flat(),...Array(t.walls.bottom*(t.size+2)).fill("").map(()=>r("BLOCK",String(n++)))]},[t]);return R("div",{role:"grid",className:"grid w-full flex-grow-0 aspect-square rounded-xl border-4 border-violet-600 max-w-full max-h-full relative overflow-hidden",style:{gridTemplateColumns:`repeat(${(t.size||0)+2}, 1fr)`},children:[l(),o(D,{}),Object.entries(a).map(([n,s])=>o(z,{...s},n))]})}function I(){return o(T,{board:{board:[["BLOCK","BLOCK","BLOCK","FREE","BLOCK","BLOCK","BLOCK","BLOCK","BLOCK"],["BLOCK","BLOCK","FREE","FREE","BLOCK","BLOCK","BLOCK","FREE","FREE"],["BLOCK","FREE","FREE","FREE","FREE","FREE","FREE","FREE","FREE"],["FREE","FREE","FREE","FREE","FREE","FREE","BLOCK","FREE","FREE"],["BLOCK","BLOCK","FREE","FREE","BLOCK","BLOCK","BLOCK","FREE","FREE"],["BLOCK","BLOCK","FREE","FREE","BLOCK","BUTTON","BUTTON","FREE","FREE"],["BLOCK","BLOCK","FREE","BLOCK","BLOCK","BUTTON","BLOCK","FREE","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","FREE","FREE","BLOCK","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","FREE","BLOCK","BLOCK","BLOCK"]],player:{x:3,y:3},boxes:[{x:4,y:3},{x:3,y:4},{x:2,y:2}]},children:R(U,{children:[o(j,{}),o($,{})]})})}function W(){return o(I,{})}export{W as default};
