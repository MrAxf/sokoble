import{u as _,r as i,R as U,a as A,b as C,j as s,c as S,M as j,d as H,e as J,f as W,g as F,h as X,i as Y,k as Q}from"./index.0888f01f.js";import{s as Z,a as V,b as ee,m as I,p as te}from"./pageAnimation.8992af32.js";function oe(){let e=!1;const t=[],l=new Set,r={subscribe(a){return l.add(a),()=>void l.delete(a)},start(a,o){if(e){const n=[];return l.forEach(c=>{n.push(ee(c,a,{transitionOverride:o}))}),Promise.all(n)}else return new Promise(n=>{t.push({animation:[a,o],resolve:n})})},set(a){return l.forEach(o=>{Z(o,a)})},stop(){l.forEach(a=>{V(a)})},mount(){return e=!0,t.forEach(({animation:a,resolve:o})=>{r.start(...a).then(o)}),()=>{e=!1,r.stop()}}};return r}function re(){const e=_(oe);return i.exports.useEffect(e.mount,[]),e}const K=U({key:"gameName",default:globalThis.localStorage.getItem("gameName")||""}),L=U({key:"gamePlayer",default:JSON.parse(globalThis.localStorage.getItem("gamePlayer")||"false")||{x:0,y:0}}),$=U({key:"gameBoxes",default:JSON.parse(globalThis.localStorage.getItem("gameBoxes")||"false")||{}}),G=U({key:"gameUndos",default:JSON.parse(globalThis.localStorage.getItem("gameUndos")||"false")||[]}),ae=A({key:"currentGameName",get:({get:e})=>e(K),set:({set:e},t)=>{e(K,t),globalThis.localStorage.setItem("gameName",t.toString())}}),se=A({key:"currentGamePlayer",get:({get:e})=>e(L),set:({set:e},t)=>{e(L,t),globalThis.localStorage.setItem("gamePlayer",JSON.stringify(t))}}),ne=A({key:"currentGameBoxes",get:({get:e})=>e($),set:({set:e},t)=>{e($,t),globalThis.localStorage.setItem("gameBoxes",JSON.stringify(t))}}),le=A({key:"currentGameUndos",get:({get:e})=>e(G),set:({set:e},t)=>{e(G,t),globalThis.localStorage.setItem("gameUndos",JSON.stringify(t))}}),D={board:{name:"",board:[],boxes:[],player:{x:0,y:0}},player:{x:0,y:0},boxes:{},meta:{size:0,walls:{top:0,bottom:0,left:0,right:0},squarePercent:0},undoStack:[],setPlayer:()=>{},setBoxes:()=>{},setMeta:()=>{},setUndoStack:()=>{}},z=i.exports.createContext({...D}),ce=({children:e,board:t})=>{const[l,r]=i.exports.useState(!1),[a,o]=C(ae),[n,c]=C(se),[g,m]=C(ne),[b,p]=C(le),[y,f]=i.exports.useState(D.meta);return i.exports.useEffect(()=>{var w;const u=Math.max(t.board.length,(w=t.board[0])==null?void 0:w.length),d=(u-t.board.length)/2,x=(u-t.board[0].length)/2,T={top:1+Math.floor(d),bottom:1+Math.ceil(d),left:1+Math.floor(x),right:1+Math.ceil(x)};return f({size:u,squarePercent:100/(u+2),walls:T}),t.name!==a&&(o(t.name),c({...t.player}),m(t.boxes.reduce((h,N,B)=>{var P;return{...h,[B]:{...N,inButton:((P=t.board[N.y])==null?void 0:P[N.x])==="BUTTON"}}},{})),p([])),r(!0),()=>{r(!1)}},[t]),s(z.Provider,{value:{board:t,player:n,boxes:g,meta:y,undoStack:b,setPlayer:c,setBoxes:m,setMeta:f,setUndoStack:p},children:l&&e})},ie=()=>{const{board:e,boxes:t,meta:l,player:r,undoStack:a,setPlayer:o,setBoxes:n,setUndoStack:c}=i.exports.useContext(z),g=f=>{var q,R;const u={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}}[f],d={x:r.x+u.x,y:r.y+u.y},x={x:d.x+u.x,y:d.y+u.y},T=(q=e.board[d.y])==null?void 0:q[d.x],w=(R=e.board[x.y])==null?void 0:R[x.x];let h,N;Object.entries(t).forEach(([E,M])=>{if(M.x===d.x&&M.y===d.y){h=parseInt(E);return}M.x===x.x&&M.y===x.y&&(N=parseInt(E))});const B=Boolean(T)&&T!=="BLOCK",P=Boolean(w)&&w!=="BLOCK";if(h===void 0&&B){c([...a,{player:{...r}}]),o(d);return}h!==void 0&&N===void 0&&B&&P&&(c([...a,{player:{...r},box:[h,t[h]]}]),o(d),n({...t,[h]:{...x,inButton:w==="BUTTON"}}))},m=()=>{const f=a.at(-1);if(f&&(c(a.slice(0,-1)),o(f.player),f.box)){const[u,d]=f.box;n({...t,[u]:{...d}})}},b=()=>{o({...e.player}),n(e.boxes.reduce((f,u,d)=>{var x;return{...f,[d]:{...u,inButton:((x=e.board[u.y])==null?void 0:x[u.x])==="BUTTON"}}},{})),c([])},p=i.exports.useMemo(()=>a.length,[a]),y=i.exports.useMemo(()=>Object.entries(t).findIndex(([,f])=>!f.inButton)===-1,[t]);return{board:e,boxes:t,meta:l,player:r,movements:p,hasWin:y,movePlayer:g,undo:m,reset:b}},k=ie;function ue({children:e}){const t=i.exports.useRef(null),{movePlayer:l,undo:r}=k(),a=o=>{if(o.preventDefault(),o.ctrlKey&&o.key==="z")r();else{const n={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"}[o.key];n&&l(n)}};return i.exports.useEffect(()=>{t.current&&t.current.focus()},[t]),s("div",{tabIndex:0,className:"h-full p-5 flex flex-col",ref:t,onKeyDown:a,children:e})}function O(){return"ontouchstart"in globalThis||navigator.maxTouchPoints>0}function de({onHoldEnded:e,holdTime:t=2e3,children:l,className:r=""}){const a=re(),o=m=>{O()||(m.preventDefault(),m.button===0&&c())},n=m=>{!O()||(m.stopPropagation(),c())},c=async()=>{try{console.log("hola"),await a.start({width:"100%",transition:{duration:t/1e3}}),e(),a.start({opacity:0})}catch(m){console.log(m)}console.log("adios")},g=()=>{a.stop(),a.set({width:"0%",opacity:1})};return S("button",{className:`relative overflow-hidden grid rounded-md text-xl place-content-center bg-secondary-main hover:bg-secondary-dark transition text-white ${r}`,onMouseDown:o,onTouchStart:n,onMouseUp:g,onMouseLeave:g,onTouchEnd:g,children:[s(I.span,{className:"absolute h-full bg-secondary-light",initial:{width:"0%"},animate:a}),s("span",{className:"z-10",children:l})]})}function v({children:e,onTick:t,interval:l=100,className:r="",tickTimeout:a=500}){const o=i.exports.useRef(),n=i.exports.useRef(),c=i.exports.useRef(t);i.exports.useEffect(()=>{c.current=t},[t]);const g=y=>{O()||(y.preventDefault(),y.button===0&&o.current==null&&b())},m=y=>{!O()||o.current==null&&b()},b=()=>{c.current(),n.current=Number(setTimeout(()=>{o.current=Number(setInterval(()=>{c.current()},l))},a))},p=()=>{n.current&&(clearTimeout(n.current),n.current=void 0),o.current&&(clearInterval(o.current),o.current=void 0)};return s("button",{className:`grid rounded-md text-xl place-content-center bg-secondary-main hover:bg-secondary-dark transition text-white ${r}`,onMouseDown:g,onTouchStart:m,onMouseLeave:p,onMouseUp:p,onTouchEnd:p,children:e})}function me(){const{movePlayer:e,undo:t,reset:l}=k();i.exports.useRef();const r=a=>()=>{e(a)};return S("div",{className:"flex-grow grid max-h-[250px] grid-cols-3 grid-rows-2 gap-2 p-2 pb-14",children:[s(v,{onTick:t,className:"row-start-1 col-start-1",children:s(j,{})}),s(v,{onTick:r("up"),className:"row-start-1 col-start-2",children:s(H,{})}),s(de,{onHoldEnded:l,className:"row-start-1 col-start-3",children:s(J,{})}),s(v,{onTick:r("left"),className:"row-start-2 col-start-1",children:s(W,{})}),s(v,{onTick:r("down"),className:"row-start-2 col-start-2",children:s(F,{})}),s(v,{onTick:r("right"),className:"row-start-2 col-start-3",children:s(X,{})})]})}function fe({x:e,y:t,inButton:l}){const{meta:r}=k();return s(I.div,{className:`absolute aspect-square rounded-md transition ${l?"bg-box-success-primary":"bg-box-primary"}`,style:{width:`${r.squarePercent}%`},animate:{left:`${(r.walls.left+e)*r.squarePercent}%`,top:`${(r.walls.top+t)*r.squarePercent}%`},children:s("div",{className:`w-1/2 transition rounded-sm ${l?"bg-box-success-secondary":"bg-box-secondary"} aspect-square m-[25%]`})})}function xe(){const{meta:e,player:t}=k();return s(I.div,{className:"absolute aspect-square rounded-full bg-player",style:{width:`${e.squarePercent}%`},animate:{left:`${(e.walls.left+t.x)*e.squarePercent}%`,top:`${(e.walls.top+t.y)*e.squarePercent}%`}})}function ge(){const{meta:e,board:t,boxes:l}=k(),r=(o,n)=>({BLOCK:s("div",{className:"bg-transparent aspect-square"},n),FREE:s("div",{className:"bg-primary-light aspect-square"},n),BUTTON:s("div",{className:"bg-primary-light aspect-square after:content-[''] after:bg-white after:rounded-full after:m-[25%] after:block after:w-1/2 after:h-1/2"},n)})[o],a=i.exports.useCallback(()=>{if(!e.size)return null;let o=0;return[...Array(e.walls.top*(e.size+2)).fill("").map(()=>r("BLOCK",String(o++))),...t.board.map(n=>[...Array(e.walls.left).fill("").map(()=>r("BLOCK",String(o++))),...n.map(c=>r(c,String(o++))),...Array(e.walls.right).fill("").map(()=>r("BLOCK",String(o++)))]).flat(),...Array(e.walls.bottom*(e.size+2)).fill("").map(()=>r("BLOCK",String(o++)))]},[e]);return S("div",{role:"grid",className:"bg-gradient-to-br from-primary-dark to-secondary-dark grid w-full flex-grow-0 aspect-square rounded-xl border-8 border-primary-main max-w-full max-h-full relative overflow-hidden",style:{gridTemplateColumns:`repeat(${(e.size||0)+2}, 1fr)`},children:[a(),s(xe,{}),Object.entries(l).map(([o,n])=>s(fe,{...n},o))]})}function pe(){const{movements:e,hasWin:t}=k();return S("div",{className:"flex-grow text-white",children:[S("span",{children:["Movimientos: ",e]}),t&&s("span",{children:"Completado!!!"})]})}function he({board:e}){return s(ce,{board:e,children:S(ue,{children:[s(ge,{}),s(pe,{}),s(me,{})]})})}function we(){const e=Y(Q);return s(I.div,{...te,className:"h-full",children:e?s(he,{board:e}):"Loading..."},"index")}export{we as default};
