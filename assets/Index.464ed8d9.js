import{r as i,j as r,a as R,M as v,b as L,c as P,d as N,m as K}from"./index.bbd68ce2.js";const w={board:{board:[],boxes:[],player:{x:0,y:0}},player:{x:0,y:0},boxes:{},meta:{size:0,walls:{top:0,bottom:0,left:0,right:0},squarePercent:0},setPlayer:()=>{},setBoxes:()=>{},setMeta:()=>{}},O=i.exports.createContext({...w}),S=({children:t,board:e})=>{const[n,o]=i.exports.useState(!1),[u,a]=i.exports.useState(w.player),[l,d]=i.exports.useState(w.boxes),[x,s]=i.exports.useState(w.meta);return i.exports.useEffect(()=>{var b;const c=Math.max(e.board.length,(b=e.board[0])==null?void 0:b.length),f=(c-e.board.length)/2,p=(c-e.board[0].length)/2,E={top:1+Math.floor(f),bottom:1+Math.ceil(f),left:1+Math.floor(p),right:1+Math.ceil(p)};return a({...e.player}),d(e.boxes.reduce((g,C,m)=>({...g,[m]:{...C}}),{})),s({size:c,squarePercent:100/(c+2),walls:E}),o(!0),()=>{o(!1)}},[e]),r(O.Provider,{value:{board:e,player:u,boxes:l,meta:x,setPlayer:a,setBoxes:d,setMeta:s},children:n&&t})},k=()=>{const{board:t,boxes:e,meta:n,player:o,setPlayer:u,setBoxes:a}=i.exports.useContext(O);return{board:t,boxes:e,meta:n,player:o,movePlayer:d=>{var m,F;const x={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}}[d],s={x:o.x+x.x,y:o.y+x.y},c={x:s.x+x.x,y:s.y+x.y},f=(m=t.board[s.y])==null?void 0:m[s.x],p=(F=t.board[c.y])==null?void 0:F[c.x];let E,b;Object.entries(e).forEach(([B,h])=>{if(h.x===s.x&&h.y===s.y){E=parseInt(B);return}h.x===c.x&&h.y===c.y&&(b=parseInt(B))});const g=Boolean(f)&&f!=="BLOCK",C=Boolean(p)&&p!=="BLOCK";if(E===void 0&&g){u(s);return}E!==void 0&&b===void 0&&g&&C&&(u(s),a({...e,[E]:c}))}}},y=k;function q({children:t}){const e=i.exports.useRef(null),{movePlayer:n}=y(),o=u=>{const a={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"}[u.key];a&&n(a)};return i.exports.useEffect(()=>{e.current&&e.current.focus()},[e]),r("div",{tabIndex:0,className:"h-full p-5 flex flex-col",ref:e,onKeyDown:o,children:t})}function A(){const{movePlayer:t}=y(),e=n=>o=>{o.preventDefault(),o.button===0&&t(n)};return R("div",{className:"flex-grow grid grid-cols-3 grid-rows-3 gap-2 p-2",children:[r("button",{className:"grid rounded-md text-xl place-content-center row-start-1 col-start-2 bg-green-500 hover:bg-green-700 transition text-white",onClick:e("up"),children:r(v,{})}),r("button",{className:"grid rounded-md text-xl place-content-center row-start-2 col-start-1 bg-green-500 hover:bg-green-700 transition text-white",onClick:e("left"),children:r(L,{})}),r("button",{className:"grid rounded-md text-xl place-content-center row-start-2 col-start-3 bg-green-500 hover:bg-green-700 transition text-white",onClick:e("right"),children:r(P,{})}),r("button",{className:"grid rounded-md text-xl place-content-center row-start-3 col-start-2 bg-green-500 hover:bg-green-700 transition text-white",onClick:e("down"),children:r(N,{})})]})}function M({x:t,y:e}){const{meta:n}=y();return r(K.div,{className:"absolute aspect-square bg-amber-700",style:{width:`${n.squarePercent}%`},animate:{left:`${(n.walls.left+t)*n.squarePercent}%`,top:`${(n.walls.top+e)*n.squarePercent}%`}})}function $(){const{meta:t,player:e}=y();return r(K.div,{className:"absolute aspect-square rounded-full bg-yellow-600",style:{width:`${t.squarePercent}%`},animate:{left:`${(t.walls.left+e.x)*t.squarePercent}%`,top:`${(t.walls.top+e.y)*t.squarePercent}%`}})}function T(){const{meta:t,board:e,boxes:n}=y(),o=(a,l)=>({BLOCK:r("div",{className:"bg-purple-900 aspect-square"},l),FREE:r("div",{className:"bg-purple-300 aspect-square"},l),BUTTON:r("div",{className:"bg-purple-300 aspect-square after:content-[''] after:bg-purple-50 after:rounded-full after:m-[25%] after:block after:w-1/2 after:h-1/2"},l)})[a],u=i.exports.useCallback(()=>{if(!t.size)return null;let a=0;return[...Array(t.walls.top*(t.size+2)).fill("").map(()=>o("BLOCK",String(a++))),...e.board.map(l=>[...Array(t.walls.left).fill("").map(()=>o("BLOCK",String(a++))),...l.map(d=>o(d,String(a++))),...Array(t.walls.right).fill("").map(()=>o("BLOCK",String(a++)))]).flat(),...Array(t.walls.bottom*(t.size+2)).fill("").map(()=>o("BLOCK",String(a++)))]},[t]);return R("div",{role:"grid",className:"grid w-full flex-grow-0 aspect-square rounded-xl border-4 border-violet-600 max-w-full max-h-full relative overflow-hidden",style:{gridTemplateColumns:`repeat(${(t.size||0)+2}, 1fr)`},children:[u(),r($,{}),Object.entries(n).map(([a,l])=>r(M,{...l},a))]})}function z(){return r(S,{board:{board:[["BLOCK","BUTTON","FREE","FREE","FREE","FREE","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","FREE","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","FREE","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","FREE","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","FREE","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","FREE","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","BUTTON","BLOCK"]],player:{x:1,y:0},boxes:[{x:3,y:3},{x:3,y:4}]},children:R(q,{children:[r(T,{}),r(A,{})]})})}function j(){return r(z,{})}export{j as default};
