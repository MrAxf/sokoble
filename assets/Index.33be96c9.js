import{R as M,a as P,r as d,j as r,b as F,M as S,c as N,d as k,e as q,m as K,f as A}from"./index.23fcea6d.js";const v=M({key:"sokobanBoard",default:{board:[["BLOCK","FREE","FREE","FREE","FREE","FREE","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","FREE","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","FREE","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","FREE","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","FREE","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","FREE","BLOCK"],["BLOCK","FREE","FREE","FREE","FREE","FREE","BLOCK"]],player:{x:1,y:0},boxes:[{x:3,y:3},{x:3,y:4}]}});P({key:"sokobanMeta",get:({get:t})=>{var s;const e=t(v),o=Math.max(e.board.length,(s=e.board[0])==null?void 0:s.length),a=(o-e.board.length)/2,l=(o-e.board[0].length)/2,n={top:1+Math.floor(a),bottom:1+Math.ceil(a),left:1+Math.floor(l),right:1+Math.ceil(l)};return{size:o,squarePercent:100/(o+2),walls:n}}});const O=v,w={board:{board:[],boxes:[],player:{x:0,y:0}},player:{x:0,y:0},boxes:{},meta:{size:0,walls:{top:0,bottom:0,left:0,right:0},squarePercent:0},setPlayer:()=>{},setBoxes:()=>{},setMeta:()=>{}},L=d.exports.createContext({...w}),D=({children:t,board:e})=>{const[o,a]=d.exports.useState(!1),[l,n]=d.exports.useState(w.player),[s,u]=d.exports.useState(w.boxes),[x,c]=d.exports.useState(w.meta);return d.exports.useEffect(()=>{var p;const i=Math.max(e.board.length,(p=e.board[0])==null?void 0:p.length),b=(i-e.board.length)/2,f=(i-e.board[0].length)/2,E={top:1+Math.floor(b),bottom:1+Math.ceil(b),left:1+Math.floor(f),right:1+Math.ceil(f)};return n({...e.player}),u(e.boxes.reduce((g,R,y)=>({...g,[y]:{...R}}),{})),c({size:i,squarePercent:100/(i+2),walls:E}),a(!0),()=>{a(!1)}},[O]),r(L.Provider,{value:{board:e,player:l,boxes:s,meta:x,setPlayer:n,setBoxes:u,setMeta:c},children:o&&t})},$=()=>{const{board:t,boxes:e,meta:o,player:a,setPlayer:l,setBoxes:n}=d.exports.useContext(L);return{board:t,boxes:e,meta:o,player:a,movePlayer:u=>{var y,C;const x={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}}[u],c={x:a.x+x.x,y:a.y+x.y},i={x:c.x+x.x,y:c.y+x.y},b=(y=t.board[c.y])==null?void 0:y[c.x],f=(C=t.board[i.y])==null?void 0:C[i.x];let E,p;Object.entries(e).forEach(([B,m])=>{if(m.x===c.x&&m.y===c.y){E=parseInt(B);return}m.x===i.x&&m.y===i.y&&(p=parseInt(B))});const g=Boolean(b)&&b!=="BLOCK",R=Boolean(f)&&f!=="BLOCK";if(E===void 0&&g){l(c);return}E!==void 0&&p===void 0&&g&&R&&(l(c),n({...e,[E]:i}))}}},h=$;function z({children:t}){const e=d.exports.useRef(null),{movePlayer:o}=h(),a=l=>{const n={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"}[l.key];n&&o(n)};return d.exports.useEffect(()=>{e.current&&e.current.focus()},[e]),r("div",{tabIndex:0,className:"h-full p-5 flex flex-col",ref:e,onKeyDown:a,children:t})}function _(){const{movePlayer:t}=h(),e=o=>a=>{a.preventDefault(),a.button===0&&t(o)};return F("div",{className:"flex-grow grid grid-cols-3 grid-rows-3 gap-2 p-2",children:[r("button",{className:"grid rounded-md text-xl place-content-center row-start-1 col-start-2 bg-green-500 hover:bg-green-700 transition text-white",onMouseDown:e("up"),children:r(S,{})}),r("button",{className:"grid rounded-md text-xl place-content-center row-start-2 col-start-1 bg-green-500 hover:bg-green-700 transition text-white",onMouseDown:e("left"),children:r(N,{})}),r("button",{className:"grid rounded-md text-xl place-content-center row-start-2 col-start-3 bg-green-500 hover:bg-green-700 transition text-white",onMouseDown:e("right"),children:r(k,{})}),r("button",{className:"grid rounded-md text-xl place-content-center row-start-3 col-start-2 bg-green-500 hover:bg-green-700 transition text-white",onMouseDown:e("down"),children:r(q,{})})]})}function j({x:t,y:e}){const{meta:o}=h();return r(K.div,{className:"absolute aspect-square bg-amber-700",style:{width:`${o.squarePercent}%`},animate:{left:`${(o.walls.left+t)*o.squarePercent}%`,top:`${(o.walls.top+e)*o.squarePercent}%`}})}function I(){const{meta:t,player:e}=h();return r(K.div,{className:"absolute aspect-square rounded-full bg-yellow-600",style:{width:`${t.squarePercent}%`},animate:{left:`${(t.walls.left+e.x)*t.squarePercent}%`,top:`${(t.walls.top+e.y)*t.squarePercent}%`}})}function W(){const{meta:t,board:e,boxes:o}=h(),a=(n,s)=>({BLOCK:r("div",{className:"bg-purple-900 aspect-square"},s),FREE:r("div",{className:"bg-purple-300 aspect-square"},s),BUTTON:r("div",{className:"bg-purple-50 aspect-square"},s)})[n],l=d.exports.useCallback(()=>{if(!t.size)return null;let n=0;return[...Array(t.walls.top*(t.size+2)).fill("").map(()=>a("BLOCK",String(n++))),...e.board.map(s=>[...Array(t.walls.left).fill("").map(()=>a("BLOCK",String(n++))),...s.map(u=>a(u,String(n++))),...Array(t.walls.right).fill("").map(()=>a("BLOCK",String(n++)))]).flat(),...Array(t.walls.bottom*(t.size+2)).fill("").map(()=>a("BLOCK",String(n++)))]},[e]);return F("div",{role:"grid",className:"grid w-full flex-grow-0 aspect-square rounded-xl border-4 border-violet-600 max-w-full max-h-full relative overflow-hidden",style:{gridTemplateColumns:`repeat(${(t.size||0)+2}, 1fr)`},children:[l(),r(I,{}),Object.entries(o).map(([n,s])=>r(j,{...s},n))]})}function T(){const t=A(O);return r(D,{board:t,children:F(z,{children:[r(W,{}),r(_,{})]})})}function G(){return r(T,{})}export{G as default};
