import{s as k,a as M,b as P,u as q,r as i,j as s,c as O,m as K,M as A,d as U,e as $,f as D,g as z,h as I}from"./index.8d81c6d5.js";function H(){let e=!1;const t=[],l=new Set,r={subscribe(n){return l.add(n),()=>void l.delete(n)},start(n,o){if(e){const a=[];return l.forEach(u=>{a.push(P(u,n,{transitionOverride:o}))}),Promise.all(a)}else return new Promise(a=>{t.push({animation:[n,o],resolve:a})})},set(n){return l.forEach(o=>{k(o,n)})},stop(){l.forEach(n=>{M(n)})},mount(){return e=!0,t.forEach(({animation:n,resolve:o})=>{r.start(...n).then(o)}),()=>{e=!1,r.stop()}}};return r}function j(){const e=q(H);return i.exports.useEffect(e.mount,[]),e}const v={board:{board:[],boxes:[],player:{x:0,y:0}},player:{x:0,y:0},boxes:{},meta:{size:0,walls:{top:0,bottom:0,left:0,right:0},squarePercent:0},undoStack:[],setPlayer:()=>{},setBoxes:()=>{},setMeta:()=>{},setUndoStack:()=>{}},S=i.exports.createContext({...v}),V=({children:e,board:t})=>{const[l,r]=i.exports.useState(!1),[n,o]=i.exports.useState(v.player),[a,u]=i.exports.useState(v.boxes),[E,p]=i.exports.useState(v.meta),[y,f]=i.exports.useState([]);return i.exports.useEffect(()=>{var m;const c=Math.max(t.board.length,(m=t.board[0])==null?void 0:m.length),d=(c-t.board.length)/2,x=(c-t.board[0].length)/2,R={top:1+Math.floor(d),bottom:1+Math.ceil(d),left:1+Math.floor(x),right:1+Math.ceil(x)};return o({...t.player}),u(t.boxes.reduce((b,h,B)=>{var C;return{...b,[B]:{...h,inButton:((C=t.board[h.y])==null?void 0:C[h.x])==="BUTTON"}}},{})),p({size:c,squarePercent:100/(c+2),walls:R}),r(!0),()=>{r(!1)}},[t]),s(S.Provider,{value:{board:t,player:n,boxes:a,meta:E,undoStack:y,setPlayer:o,setBoxes:u,setMeta:p,setUndoStack:f},children:l&&e})},G=()=>{const{board:e,boxes:t,meta:l,player:r,undoStack:n,setPlayer:o,setBoxes:a,setUndoStack:u}=i.exports.useContext(S);return{board:e,boxes:t,meta:l,player:r,movePlayer:f=>{var T,L;const c={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}}[f],d={x:r.x+c.x,y:r.y+c.y},x={x:d.x+c.x,y:d.y+c.y},R=(T=e.board[d.y])==null?void 0:T[d.x],m=(L=e.board[x.y])==null?void 0:L[x.x];let b,h;Object.entries(t).forEach(([N,F])=>{if(F.x===d.x&&F.y===d.y){b=parseInt(N);return}F.x===x.x&&F.y===x.y&&(h=parseInt(N))});const B=Boolean(R)&&R!=="BLOCK",C=Boolean(m)&&m!=="BLOCK";if(b===void 0&&B){u([...n,{player:{...r}}]),o(d);return}b!==void 0&&h===void 0&&B&&C&&(u([...n,{player:{...r},box:[b,t[b]]}]),o(d),a({...t,[b]:{...x,inButton:m==="BUTTON"}}))},undo:()=>{const f=n.at(-1);if(f&&(u(n.slice(0,-1)),o(f.player),f.box)){const[c,d]=f.box;a({...t,[c]:{...d}})}},reset:()=>{o({...e.player}),a(e.boxes.reduce((f,c,d)=>{var x;return{...f,[d]:{...c,inButton:((x=e.board[c.y])==null?void 0:x[c.x])==="BUTTON"}}},{}))}}},g=G;function W({children:e}){const t=i.exports.useRef(null),{movePlayer:l,undo:r}=g(),n=o=>{if(o.preventDefault(),o.ctrlKey&&o.key==="z")r();else{const a={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"}[o.key];a&&l(a)}};return i.exports.useEffect(()=>{t.current&&t.current.focus()},[t]),s("div",{tabIndex:0,className:"h-full p-5 flex flex-col",ref:t,onKeyDown:n,children:e})}function X({onHoldEnded:e,holdTime:t=2e3,children:l,className:r=""}){const n=j(),o=p=>{p.preventDefault(),p.button===0&&u()},a=p=>{u()},u=async()=>{await n.start({width:"100%",transition:{duration:t/1e3}}),e(),n.start({opacity:0})},E=()=>{n.stop(),n.set({width:"0%",opacity:1})};return O("button",{className:`relative overflow-hidden grid rounded-md text-xl place-content-center bg-green-500 hover:bg-green-700 transition text-white ${r}`,onMouseDown:o,onTouchStart:a,onMouseUp:E,onMouseLeave:E,onTouchEnd:E,children:[s(K.span,{className:"absolute h-full bg-blue-500",initial:{width:"0%"},animate:n}),s("span",{className:"z-10",children:l})]})}function w({children:e,onTick:t,interval:l=100,className:r="",tickTimeout:n=500}){const o=i.exports.useRef(),a=i.exports.useRef(),u=i.exports.useRef(t);i.exports.useEffect(()=>{u.current=t},[t]);const E=c=>{c.preventDefault(),c.button===0&&o.current==null&&y()},p=c=>{o.current==null&&y()},y=()=>{u.current(),a.current=Number(setTimeout(()=>{o.current=Number(setInterval(()=>{u.current()},l))},n))},f=()=>{a.current&&(clearTimeout(a.current),a.current=void 0),o.current&&(clearInterval(o.current),o.current=void 0)};return s("button",{className:`grid rounded-md text-xl place-content-center bg-green-500 hover:bg-green-700 transition text-white ${r}`,onMouseDown:E,onTouchStart:p,onMouseLeave:f,onMouseUp:f,onTouchEnd:f,children:e})}function Y(){const{movePlayer:e,undo:t,reset:l}=g();i.exports.useRef();const r=n=>()=>{e(n)};return O("div",{className:"flex-grow grid max-h-[250px] grid-cols-3 grid-rows-2 gap-2 p-2 pb-14",children:[s(w,{onTick:t,className:"row-start-1 col-start-1",children:s(A,{})}),s(w,{onTick:r("up"),className:"row-start-1 col-start-2",children:s(U,{})}),s(X,{onHoldEnded:l,className:"row-start-1 col-start-3",children:s($,{})}),s(w,{onTick:r("left"),className:"row-start-2 col-start-1",children:s(D,{})}),s(w,{onTick:r("down"),className:"row-start-2 col-start-2",children:s(z,{})}),s(w,{onTick:r("right"),className:"row-start-2 col-start-3",children:s(I,{})})]})}function J({x:e,y:t,inButton:l}){const{meta:r}=g();return s(K.div,{className:`absolute aspect-square rounded-md transition ${l?"bg-blue-700":"bg-orange-700"}`,style:{width:`${r.squarePercent}%`},animate:{left:`${(r.walls.left+e)*r.squarePercent}%`,top:`${(r.walls.top+t)*r.squarePercent}%`},children:s("div",{className:`w-1/2 transition ${l?"bg-blue-500":"bg-orange-500"} aspect-square m-[25%]`})})}function Q(){const{meta:e,player:t}=g();return s(K.div,{className:"absolute aspect-square rounded-full bg-yellow-600",style:{width:`${e.squarePercent}%`},animate:{left:`${(e.walls.left+t.x)*e.squarePercent}%`,top:`${(e.walls.top+t.y)*e.squarePercent}%`}})}function Z(){const{meta:e,board:t,boxes:l}=g(),r=(o,a)=>({BLOCK:s("div",{className:"bg-purple-900 aspect-square"},a),FREE:s("div",{className:"bg-purple-300 aspect-square"},a),BUTTON:s("div",{className:"bg-purple-300 aspect-square after:content-[''] after:bg-purple-50 after:rounded-full after:m-[25%] after:block after:w-1/2 after:h-1/2"},a)})[o],n=i.exports.useCallback(()=>{if(!e.size)return null;let o=0;return[...Array(e.walls.top*(e.size+2)).fill("").map(()=>r("BLOCK",String(o++))),...t.board.map(a=>[...Array(e.walls.left).fill("").map(()=>r("BLOCK",String(o++))),...a.map(u=>r(u,String(o++))),...Array(e.walls.right).fill("").map(()=>r("BLOCK",String(o++)))]).flat(),...Array(e.walls.bottom*(e.size+2)).fill("").map(()=>r("BLOCK",String(o++)))]},[e]);return O("div",{role:"grid",className:"grid w-full flex-grow-0 aspect-square rounded-xl border-4 border-violet-600 max-w-full max-h-full relative overflow-hidden",style:{gridTemplateColumns:`repeat(${(e.size||0)+2}, 1fr)`},children:[n(),s(Q,{}),Object.entries(l).map(([o,a])=>s(J,{...a},o))]})}function _(){return s(V,{board:{board:[["BLOCK","FREE","FREE","BLOCK","BLOCK","BLOCK","FREE","FREE"],["FREE","FREE","FREE","FREE","FREE","FREE","FREE","FREE"],["FREE","FREE","FREE","FREE","FREE","BLOCK","FREE","FREE"],["BLOCK","FREE","FREE","BLOCK","BLOCK","BLOCK","FREE","FREE"],["BLOCK","FREE","FREE","BLOCK","BUTTON","BUTTON","FREE","FREE"],["BLOCK","FREE","BLOCK","BLOCK","BUTTON","BLOCK","FREE","BLOCK"],["FREE","FREE","FREE","FREE","FREE","FREE","BLOCK","BLOCK"],["FREE","FREE","FREE","FREE","FREE","BLOCK","BLOCK","BLOCK"]],player:{x:2,y:2},boxes:[{x:3,y:2},{x:2,y:3},{x:1,y:1}]},children:O(W,{children:[s(Z,{}),s("div",{className:"flex-grow"}),s(Y,{})]})})}function te(){return s(_,{})}export{te as default};
